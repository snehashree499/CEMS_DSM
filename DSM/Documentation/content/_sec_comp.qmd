# 1-Bit Quantiser
// Add info @Hreeshi

## Designing the 1-Bit Quantiser
Based on the collected experience in this lecture we are desiging a 1-bit Quantiser (Comparator) in Xschem. 
Below is the prepared comparator design which will be discused in detail next.

//Add the circuit diagram


![Schematic for Strong arm latch.](/figures/Comparator.svg){#fig-techsweep-nmos-tb}

## Comparator

It is a block which takes two inputs V1 and V2 and finds weatehr ${V_\mathrm{1}}$ < ${V_\mathrm{2}}$ or ${V_\mathrm{1}}$ > ${V_\mathrm{2}}$. If ${V_\mathrm{1}}$ > ${V_\mathrm{2}}$ then output is ${V_\mathrm{DD}}$ or the output will be 0.

The ideal input-output chracteristics should look like a signum function.

// Add the ip-op graph

## Designing a comparator

Consider a amplier with a sufficiently large gain. For simplicity consider one input ${V_\mathrm{in}}$, the output is going to be amplified by factor A. Amplifier operates between ${V_\mathrm{DD}}$ and GND. If the gain is large emough the output will saturate to ${V_\mathrm{DD}}$ or GND. 


The minimum input for which the output will be ${V_\mathrm{DD}}$ here is ${V_\mathrm{DD}}$/$A$, the comparator will give output ${V_\mathrm{DD}}$.

The output will be fed to a digital block, usually a flip flop to resample the obtained output. The output of the amplifier should be greater than the input ${V_\mathrm{IH}}$ given to flip flop to get output digital 1. 

@fig-comp-tran shows the transient analysis of our comparator.

![Transient Analysis of Comparator](figures/_fig_comp_tran.svg){#fig-comp-tran}

As we know that the common implementation of first stage OTA is "Differential Pair" as shown in @fig-diffpair.

// Add the figure

The gain of the circuit @fig-diffpair is ,
${V_\mathrm{out}}$ = ${g_\mathrm{m}R}$$\Delta V$
The output of the @fig-diffpair is initially 0 and when input is applied the output will slowly raises due to parasitic capacitors. Then it will settle exponentially.
The closed form expression for exponentially settling behaviour is given by,
${g_\mathrm{m}R}$$\Delta V$$ 1-exp^{-t/$\tau}$
//Add equation

To increase the speed of the output curve we have to choose tow as the magnitude of tow cannot be changed. So we can replace the resistor by negative resistor in order to get quicker settling.

$$
{g_\mathrm{m}R}$$\Delta V$
{g_\mathrm{m}R}$$\Delta V$ - ${g_\mathrm{m}R}$$\Delta V$
$$

Negative resistor is if we apply voltage we should not be drawing current but we should put the current in the node in order get negative reistance. We cannot have a constant current source because it should depend on ${V_\mathrm{t}}$ so we should use voltage control current source. Simplest voltage control current source is MOSFET. Therefore we replace resistors by PMOS's as shown in @fig-rbypmos.

// Add figure

Initially, output voltages ${V_\mathrm{x}}$ and ${V_\mathrm{y}}$ will drop since we are pulling out current from the top two PMOS's. ${V_\mathrm{x}}$ will drop faster than ${V_\mathrm{y}}$. If ${V_\mathrm{x}}$ starts reducing, current in that transistor increases and that current will be much larger than the current we are pulling out and hence ${V_\mathrm{y}}$ will start to increase.
If ${V_\mathrm{y}}$ increases, the gate voltage at ${V_\mathrm{x}}$ will increase so the current decreases. So, we are pushing in lesser current than we are pulling out, hence ${V_\mathrm{x}}$ will drop further.
Therefore, ${V_\mathrm{y}}$ will go to ${V_\mathrm{DD}}$
           ${V_\mathrm{x}}$ will go to 0
This kind of exponential increase is called "Regeneration".

When $\Delta V$ < 0, ${V_\mathrm{y}}$ should go down and ${V_\mathrm{x}}$ should go to ${V_\mathrm{DD}}$. But problem of this approcah is due to ppsitive feedback that is trying to set these voltages to ${V_\mathrm{DD}}$ and 0. Once it is set to 0 and ${V_\mathrm{DD}}$, positive feedback will reinforce that voltage and try to keep it same.
So, by using positive feedback, PMOS's are in the same state and we are trying to change states using below two NMOS's. Unless the current that is drawn from node Vy is much stronger, we cannot pull that dpwn to 0V.
The reason behind this is that even after finishing the comparission for the previous input we are retaining the same output state and starting a fresh comparision with the same state. So, we have to reset it both to some value.
We have total time of 0 to ${T_\mathrm{s}}$ in which half the time we are dedicating it for sampling and remaining half is dedicated for regeneration.
Comparator is active in regeneration state, say it $\phi c$ and at sampling $\overline{\phi c}$. We can reset the outputs at sampling phase. For this we use switches and will reset to ${V_\mathrm{DD}}$.

//Add figure

The two NMOS's need not be active when resetting the two PMOS's. So we can turn them off by turning the bottom NMOS off. So, we can clock it at $\phi c$. **PMOS** can be used for switches.

//Add figure

The output of above @figure,
When $\phi c$ is 0, voltage at points X and Y is at 0V.
When $\phi c$ is 1 (swtches are off), initially ${V_\mathrm{x}}$ drops faster and when ${V_\mathrm{DD}}$-${V_\mathrm{TH}}$ is greater, PMOS turns on. First ${V_\mathrm{y}}$ will start increasing and goes to ${V_\mathrm{DD}}$, ${V_\mathrm{x}}$ starts to drop.


The major issue in this approach is that the comparision is stopped at certain point and ${V_\mathrm{y}}$=${V_\mathrm{DD}}$ , ${V_\mathrm{x}}$=0.
The NMOS towards right side is ON and allow the above corresponding PMOS. So, even after the comparission is completed the power consumption even though there is no change in inputs and outputs.
If differential voltage is more that is, $\frac{\Delta V}{2}$ then the ${V_\mathrm{2}} will be very small and it will be off.
But for small ${\Delta V}$, there is a direct path from ${V_\mathrm{DD}}$ to ground and we will have static power consumption.

To solve this issue there is a direct connection between PMOS and NMOS which is having direct path from ${V_\mathrm{DD}}$ to ground . So, we should add some element in between A and B as shown in below @fig

// Add figure

We want node B to be OFF when ${V_\mathrm{x}}$=0 and node A must be ON when ${V_\mathrm{y}}$=${V_\mathrm{DD}}$, NMOS transistor with gate connected to ${V_\mathrm{x}}$ and ${V_\mathrm{y}}$ will do this as shown in @fig 

// Add figure

In this @fig the drains and gates of PMOS and NMOS are connected with each other and this is basically a **CMOS inverter**.

Drawing it neatly as in @fig 

// Add figure

In practice there is one more modification made, along with ressetting X and Y we will also reset P and Q.

${V_\mathrm{1}}$-${V_\mathrm{2}}$ = ${\Delta V}$ > 0

When, $\phi c$ = 0, ${V_\mathrm{X,Y,P,Q}}$ = ${V_\mathrm{DD}}$
When, $\phi c$ = ON, switches are OFF.

## Latch

Latches are heart of all comparators, the goal of all these are to emulate the negative resistance to get the regeration in exponential fashion.



# Realisation of 1-Bit Quantizer {#sec-Quantizer}
// Add content @Hreeshi

## Designing of the 1-Bit Quantiser
Based on the collected experience in this lecture we are desiging a 1-bit Quantiser (Comparator) in Xschem. 
@fig-Comparator-sch is the prepared comparator design which will be discused in detail next.

![Schematic for Strong arm latch.](/figures/Comparator.svg){#fig-Comparator-sch}

## Defining a Comparator 

This block compares two input voltages, ${V_\mathrm{1}}$ and ${V_\mathrm{2}}$ and determines their relationship. If ${V_\mathrm{1}}$ > ${V_\mathrm{2}}$ output is set to ${V_\mathrm{DD}}$. Otherwise,if {V_\mathrm{1}}$ < ${V_\mathrm{2}}$ the output is 0${V_\mathrm{}}$.

The ideal input-output characteristics should resemble a signum function, as illustrated in @fig-Ip_Op(Comp).

![Ideal Input-Output Charecteristics of a Comparator](/figures/_fig_Ip_Op(Comp).svg){#fig-Ip_Op(Comp)}

## Realising a Comparator

Consider an amplier with a sufficiently large gain. For simplicity consider one input ${V_\mathrm{in}}$, the output is going to be amplified by factor A. Amplifier operates between ${V_\mathrm{DD}}$ and GND. If the gain is large emough the output will saturate to ${V_\mathrm{DD}}$ or GND. 

The minimum input required for the output to reach ${V_\mathrm{DD}}$ is ${V_\mathrm{DD}}$/$A$, at which point the comparator produces an output of ${V_\mathrm{DD}}$.

The output is then fed into a digital block, typically a flip-flop, to resample the obtained signal. For the flip-flop to register a digital 1, the amplifierâ€™s output must exceed the input threshold voltage ${V_\mathrm{TH}}$. 

As we know that the common implementation of first stage OTA is "Differential Pair" as shown in @fig-diffpair.

![Differential Pair](/figures/_fig_Diff_Pair.svg){#fig-diffpair}

The gain of the circuit, as shown in @fig-diffpair is given by:
${V_\mathrm{out}}$ = ${g_\mathrm{m}R}$$\Delta V$
Initially, the output of @fig-diffpair is zero. When an input is applied, the output gradually increases due to the influence of parasitic capacitances. Over time, it settles exponentially to its final value.
The closed form expression for exponentially settling behaviour is given by:
$$
V_{\mathrm{out}} = g_m R \Delta V \left(1 - e^{-t/\tau}\right)
$$

To accelerate the response of the output curve, we need to adjust ${\tau}$ as its magnitude cannot be directly altered. One effective approach is to replace the resistor with a negative resistor, which helps achieve faster settling.    

$$
-g_m R \Delta V \left(1 - e^{t/\tau}\right)
g_m R \Delta V \left(1 - e^{t/\tau}\right) - {g_\mathrm{m}R}$$\Delta V
$${#eq-closed-form-exponential}

@eq-closed-form-exponential gives much quicker settling in the output.

Negative resistor is if we apply voltage we should not be drawing current but we should put the current in the node in order get negative reistance. We cannot have a constant current source because it should depend on ${V_\mathrm{t}}$ so we should use voltage control current source. Simplest voltage control current source is MOSFET. Therefore we replace resistors by PMOS's as shown in @fig-rbypmos.

A negative resistor is characterized by the property that when a voltage is applied, it does not draw current but instead injects current into the node, effectively creating negative resistance. A constant current source cannot be used in this case, as the current must depend on ${V_\mathrm{t}}$. Therefore, a voltage-controlled current source is required. The simplest implementation of a voltage-controlled current source is a MOSFET. Consequently, resistors are replaced with PMOS transistors, as illustrated in @fig-rbypmos.

// Add figure

Initially, output voltages ${V_\mathrm{x}}$ and ${V_\mathrm{y}}$ will drop since we are pulling out current from the top two PMOS's. ${V_\mathrm{x}}$ will drop faster than ${V_\mathrm{y}}$. If ${V_\mathrm{x}}$ starts reducing, current in that transistor increases and that current will be much larger than the current we are pulling out and hence ${V_\mathrm{y}}$ will start to increase.
If ${V_\mathrm{y}}$ increases, the gate voltage at ${V_\mathrm{x}}$ will increase so the current decreases. So, we are pushing in lesser current than we are pulling out, hence ${V_\mathrm{x}}$ will drop further.
Therefore, ${V_\mathrm{y}}$ will go to ${V_\mathrm{DD}}$
           ${V_\mathrm{x}}$ will go to 0
This kind of exponential increase is called "Regeneration".

When $\Delta V$ < 0, ${V_\mathrm{y}}$ should go down and ${V_\mathrm{x}}$ should go to ${V_\mathrm{DD}}$. But problem of this approcah is due to ppsitive feedback that is trying to set these voltages to ${V_\mathrm{DD}}$ and 0. Once it is set to 0 and ${V_\mathrm{DD}}$, positive feedback will reinforce that voltage and try to keep it same.
So, by using positive feedback, PMOS's are in the same state and we are trying to change states using below two NMOS's. Unless the current that is drawn from node Vy is much stronger, we cannot pull that dpwn to 0V.
The reason behind this is that even after finishing the comparission for the previous input we are retaining the same output state and starting a fresh comparision with the same state. So, we have to reset it both to some value.
We have total time of 0 to ${T_\mathrm{s}}$ in which half the time we are dedicating it for sampling and remaining half is dedicated for regeneration.
Comparator is active in regeneration state, say it $\phi c$ and at sampling $\overline{\phi c}$. We can reset the outputs at sampling phase. For this we use switches and will reset to ${V_\mathrm{DD}}$.

//Add figure

The two NMOS's need not be active when resetting the two PMOS's. So we can turn them off by turning the bottom NMOS off. So, we can clock it at $\phi c$. **PMOS** can be used for switches.

//Add figure

The output of above @figure,
When $\phi c$ is 0, voltage at points X and Y is at 0V.
When $\phi c$ is 1 (swtches are off), initially ${V_\mathrm{x}}$ drops faster and when ${V_\mathrm{DD}}$-${V_\mathrm{TH}}$ is greater, PMOS turns on. First ${V_\mathrm{y}}$ will start increasing and goes to ${V_\mathrm{DD}}$, ${V_\mathrm{x}}$ starts to drop.


The major issue in this approach is that the comparision is stopped at certain point and ${V_\mathrm{y}}$=${V_\mathrm{DD}}$ , ${V_\mathrm{x}}$=0.
The NMOS towards right side is ON and allow the above corresponding PMOS. So, even after the comparission is completed the power consumption even though there is no change in inputs and outputs.
If differential voltage is more that is, $\frac{\Delta V}{2}$ then the ${V_\mathrm{2}} will be very small and it will be off.
But for small ${\Delta V}$, there is a direct path from ${V_\mathrm{DD}}$ to ground and we will have static power consumption.

To solve this issue there is a direct connection between PMOS and NMOS which is having direct path from ${V_\mathrm{DD}}$ to ground . So, we should add some element in between A and B as shown in below @fig

// Add figure

We want node B to be OFF when ${V_\mathrm{x}}$=0 and node A must be ON when ${V_\mathrm{y}}$=${V_\mathrm{DD}}$, NMOS transistor with gate connected to ${V_\mathrm{x}}$ and ${V_\mathrm{y}}$ will do this as shown in @fig 

// Add figure

In this @fig the drains and gates of PMOS and NMOS are connected with each other and this is basically a **CMOS inverter**.

Drawing it neatly as in @fig 

// Add figure

In practice there is one more modification made, along with ressetting X and Y we will also reset P and Q.

${V_\mathrm{1}}$-${V_\mathrm{2}}$ = ${\Delta V}$ > 0

When, $\phi c$ = 0, ${V_\mathrm{X,Y,P,Q}}$ = ${V_\mathrm{DD}}$
When, $\phi c$ = ON, switches are OFF.

@fig-comp-tran shows the transient analysis of our comparator.

![Transient Analysis of Comparator](figures/_fig_comp_tran.svg){#fig-comp-tran}

## Latch

Latches are heart of all comparators, the goal of all these are to emulate the negative resistance to get the regeration in exponential fashion.



